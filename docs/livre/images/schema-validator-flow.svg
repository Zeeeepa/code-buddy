<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 400">
  <defs>
    <linearGradient id="bgGradSV" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#1a1a2e;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#16213e;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="inputGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#e74c3c;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#c0392b;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="extractGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f39c12;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#d68910;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="validateGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#3498db;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2980b9;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="outputGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#2ecc71;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#27ae60;stop-opacity:1" />
    </linearGradient>
  </defs>

  <!-- Background -->
  <rect width="800" height="400" fill="url(#bgGradSV)"/>

  <!-- Title -->
  <text x="400" y="35" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#ffffff" text-anchor="middle">Schema Validator - Flow</text>
  <text x="400" y="55" font-family="Arial, sans-serif" font-size="12" fill="#888888" text-anchor="middle">Extraction et validation JSON avec tolerance aux erreurs</text>

  <!-- Step 1: LLM Response -->
  <rect x="50" y="80" width="160" height="100" rx="10" fill="url(#inputGrad)" stroke="#ec7063" stroke-width="2"/>
  <text x="130" y="105" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#ffffff" text-anchor="middle">1. LLM Response</text>
  <rect x="60" y="115" width="140" height="55" rx="5" fill="#2d3436"/>
  <text x="70" y="132" font-family="monospace" font-size="8" fill="#888888">I will use the</text>
  <text x="70" y="145" font-family="monospace" font-size="8" fill="#888888">read_file tool:</text>
  <text x="70" y="158" font-family="monospace" font-size="8" fill="#f39c12">{"tool": "read",</text>
  <text x="70" y="168" font-family="monospace" font-size="8" fill="#e74c3c"> "path": "x.txt",}</text>

  <!-- Arrow 1->2 -->
  <path d="M 210 130 L 255 130" stroke="#ec7063" stroke-width="2" fill="none"/>
  <polygon points="255,125 265,130 255,135" fill="#ec7063"/>

  <!-- Step 2: Extract JSON -->
  <rect x="265" y="80" width="160" height="100" rx="10" fill="url(#extractGrad)" stroke="#f5b041" stroke-width="2"/>
  <text x="345" y="105" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#ffffff" text-anchor="middle">2. Extract JSON</text>
  <rect x="275" y="115" width="140" height="55" rx="5" fill="#2d3436"/>
  <text x="285" y="132" font-family="Arial, sans-serif" font-size="8" fill="#888888">Code block?</text>
  <text x="285" y="145" font-family="Arial, sans-serif" font-size="8" fill="#888888">Direct JSON?</text>
  <text x="285" y="158" font-family="Arial, sans-serif" font-size="8" fill="#888888">Embedded in text?</text>
  <text x="285" y="168" font-family="Arial, sans-serif" font-size="8" fill="#2ecc71">Fix trailing commas</text>

  <!-- Arrow 2->3 -->
  <path d="M 425 130 L 470 130" stroke="#f5b041" stroke-width="2" fill="none"/>
  <polygon points="470,125 480,130 470,135" fill="#f5b041"/>

  <!-- Step 3: Validate -->
  <rect x="480" y="80" width="160" height="100" rx="10" fill="url(#validateGrad)" stroke="#5dade2" stroke-width="2"/>
  <text x="560" y="105" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#ffffff" text-anchor="middle">3. Validate Schema</text>
  <rect x="490" y="115" width="140" height="55" rx="5" fill="#2d3436"/>
  <text x="500" y="132" font-family="Arial, sans-serif" font-size="8" fill="#888888">Type checking</text>
  <text x="500" y="145" font-family="Arial, sans-serif" font-size="8" fill="#888888">Required fields</text>
  <text x="500" y="158" font-family="Arial, sans-serif" font-size="8" fill="#3498db">Coerce types</text>
  <text x="500" y="168" font-family="Arial, sans-serif" font-size="8" fill="#3498db">Apply defaults</text>

  <!-- Arrow 3->4 -->
  <path d="M 640 130 L 685 130" stroke="#5dade2" stroke-width="2" fill="none"/>
  <polygon points="685,125 695,130 685,135" fill="#5dade2"/>

  <!-- Step 4: Output -->
  <rect x="695" y="80" width="90" height="100" rx="10" fill="url(#outputGrad)" stroke="#58d68d" stroke-width="2"/>
  <text x="740" y="105" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#ffffff" text-anchor="middle">4. Valid</text>
  <rect x="705" y="115" width="70" height="55" rx="5" fill="#2d3436"/>
  <text x="740" y="135" font-family="monospace" font-size="8" fill="#2ecc71" text-anchor="middle">{</text>
  <text x="740" y="148" font-family="monospace" font-size="8" fill="#2ecc71" text-anchor="middle">tool,</text>
  <text x="740" y="161" font-family="monospace" font-size="8" fill="#2ecc71" text-anchor="middle">path</text>
  <text x="740" y="174" font-family="monospace" font-size="8" fill="#2ecc71" text-anchor="middle">}</text>

  <!-- Type coercion examples -->
  <rect x="50" y="200" width="700" height="90" rx="10" fill="#2d3436" stroke="#636e72" stroke-width="1"/>
  <text x="400" y="225" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#ffffff" text-anchor="middle">Type Coercion Automatique</text>

  <text x="100" y="255" font-family="monospace" font-size="10" fill="#e74c3c">"123"</text>
  <text x="160" y="255" font-family="Arial, sans-serif" font-size="10" fill="#888888">-></text>
  <text x="185" y="255" font-family="Arial, sans-serif" font-size="10" fill="#888888">number</text>
  <text x="240" y="255" font-family="Arial, sans-serif" font-size="10" fill="#888888">-></text>
  <text x="265" y="255" font-family="monospace" font-size="10" fill="#2ecc71">123</text>

  <text x="350" y="255" font-family="monospace" font-size="10" fill="#e74c3c">"true"</text>
  <text x="410" y="255" font-family="Arial, sans-serif" font-size="10" fill="#888888">-></text>
  <text x="435" y="255" font-family="Arial, sans-serif" font-size="10" fill="#888888">boolean</text>
  <text x="500" y="255" font-family="Arial, sans-serif" font-size="10" fill="#888888">-></text>
  <text x="525" y="255" font-family="monospace" font-size="10" fill="#2ecc71">true</text>

  <text x="600" y="255" font-family="monospace" font-size="10" fill="#e74c3c">1</text>
  <text x="630" y="255" font-family="Arial, sans-serif" font-size="10" fill="#888888">-></text>
  <text x="655" y="255" font-family="Arial, sans-serif" font-size="10" fill="#888888">boolean</text>
  <text x="720" y="255" font-family="Arial, sans-serif" font-size="10" fill="#888888">-></text>
  <text x="740" y="255" font-family="monospace" font-size="10" fill="#2ecc71">true</text>

  <text x="400" y="280" font-family="Arial, sans-serif" font-size="10" fill="#888888" text-anchor="middle">~15% des reponses LLM necessitent une coercion</text>

  <!-- Common schemas -->
  <rect x="50" y="305" width="220" height="80" rx="8" fill="#2d2d44" stroke="#3498db" stroke-width="1"/>
  <text x="160" y="325" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#3498db" text-anchor="middle">TOOL_CALL_SCHEMA</text>
  <text x="70" y="345" font-family="monospace" font-size="9" fill="#ffffff">tool: string</text>
  <text x="70" y="360" font-family="monospace" font-size="9" fill="#ffffff">arguments: object</text>
  <text x="70" y="375" font-family="monospace" font-size="9" fill="#888888">reasoning?: string</text>

  <rect x="290" y="305" width="220" height="80" rx="8" fill="#2d2d44" stroke="#9b59b6" stroke-width="1"/>
  <text x="400" y="325" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#9b59b6" text-anchor="middle">ACTION_PLAN_SCHEMA</text>
  <text x="310" y="345" font-family="monospace" font-size="9" fill="#ffffff">goal: string</text>
  <text x="310" y="360" font-family="monospace" font-size="9" fill="#ffffff">steps: Step[]</text>
  <text x="310" y="375" font-family="monospace" font-size="9" fill="#888888">estimatedSteps?: number</text>

  <rect x="530" y="305" width="220" height="80" rx="8" fill="#2d2d44" stroke="#2ecc71" stroke-width="1"/>
  <text x="640" y="325" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2ecc71" text-anchor="middle">CODE_EDIT_SCHEMA</text>
  <text x="550" y="345" font-family="monospace" font-size="9" fill="#ffffff">file: string</text>
  <text x="550" y="360" font-family="monospace" font-size="9" fill="#ffffff">operation: enum</text>
  <text x="550" y="375" font-family="monospace" font-size="9" fill="#888888">oldContent?: string</text>
</svg>
